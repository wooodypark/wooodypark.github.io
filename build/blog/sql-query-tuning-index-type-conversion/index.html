<!DOCTYPE html> <html lang=" en "><head> <meta charset="utf-8" /> <title> SQL 쿼리 튜닝: 인덱스가 있어도 느린 쿼리 - woody's blog </title> <meta http-equip="X-UA-Compatible" content="IE=edge" /> <meta name="viewport" content="width=device-width, initial-scale=1" /> <meta name="description" content="인덱스를 추가했는데도 쿼리가 느린 이유를 찾아보고 실행계획 분석의 중요성에 대해 알아봅시다. (feat.자동 형변환)- SQL 쿼리 튜닝: 인덱스가 있어도 느린 쿼리"> <meta name="keywords" content="SQL 쿼리 튜닝: 인덱스가 있어도 느린 쿼리, woody's blog, sql,sql, query tuning, index, explain, database optimization, postgresql, gist index" /> <link rel="alternate" type="application/rss+xml" title="RSS" href="/feed.xml" /> <meta content="" property="fb:app_id" /> <meta content="woody's blog" property="og:site_name" /> <meta content="SQL 쿼리 튜닝: 인덱스가 있어도 느린 쿼리" property="og:title" /> <meta content="article" property="og:type" /> <meta content="인덱스를 추가했는데도 쿼리가 느린 이유를 찾아보고 실행계획 분석의 중요성에 대해 알아봅시다. (feat.자동 형변환)" property="og:description" /> <meta content="http://localhost:4000/blog/sql-query-tuning-index-type-conversion/" property="og:url" /> <meta content="2025-11-15T20:45:31+09:00" property="article:published_time" /> <meta content="http://localhost:4000/about/" property="article:author" /> <meta content="http://localhost:4000/assets/img/posts/sql1.jpg" property="og:image" /> <meta content="sql" property="article:section" /> <!-- Twitter Cards --> <meta name="twitter:card" content="summary" /> <meta name="twitter:site" content="@" /> <meta name="twitter:creator" content="@" /> <meta name="twitter:title" content="SQL 쿼리 튜닝: 인덱스가 있어도 느린 쿼리" /> <meta name="twitter:url" content="http://localhost:4000/blog/sql-query-tuning-index-type-conversion/" /> <meta name="twitter:description" content="인덱스를 추가했는데도 쿼리가 느린 이유를 찾아보고 실행계획 분석의 중요성에 대해 알아봅시다. (feat.자동 형변환)" /> <link rel="stylesheet" href="http://localhost:4000/assets/css/main.css" /> <!-- <link rel="stylesheet" href="http://localhost:4000/assets/css/custom-style.css" /> --> <link rel="stylesheet" href="http://localhost:4000/assets/bower_components/lightgallery/dist/css/lightgallery.min.css" /> <link rel="stylesheet" href="https://cdn.snipcart.com/themes/v3.0.0-beta.3/default/snipcart.css" /> <link rel="stylesheet" href="http://localhost:4000/assets/bower_components/bootstrap/dist/css/bootstrap.min.css" /> <link rel="stylesheet" href="http://localhost:4000/assets/bower_components/font-awesome/web-fonts-with-css/css/fontawesome-all.min.css" /> <link rel="stylesheet" href="http://localhost:4000/assets/bower_components/icono/dist/icono.min.css" /> <!-- Fonts--> <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet" /> <!-- Favicon --> <link rel="icon" href="http://localhost:4000/assets/img/favicon.ico" type="image/gif" sizes="16x16" /> <script> var base_url = 'http://localhost:4000'; </script> <!-- Jquery --> <script src="https://code.jquery.com/jquery-3.4.1.min.js" integrity="sha384-vk5WoKIaW/vJyUAd9n/wmopsmNhiy+L2Z+SBxGYnUkunIxVxAv/UtMOhba/xskxh" crossorigin="anonymous"></script> <!-- <script src="http://localhost:4000/assets/bower_components/jquery/dist/jquery.min.js"></script> --> <script src="http://localhost:4000/assets/js/mode-switcher.js"></script> <script src="http://localhost:4000/assets/bower_components/jquery.easing/jquery.easing.min.js"></script> <script src="http://localhost:4000/assets/bower_components/bootstrap/dist/js/bootstrap.bundle.min.js"></script> <script src="http://localhost:4000/assets/bower_components/jquery-mousewheel/jquery.mousewheel.min.js"></script> <script src="http://localhost:4000/assets/bower_components/ghosthunter/dist/jquery.ghostHunter.min.js"></script> <script src="http://localhost:4000/assets/bower_components/lightgallery/dist/js/lightgallery-all.min.js"></script> <script src="https://cdnjs.cloudflare.com/ajax/libs/picturefill/3.0.2/picturefill.min.js"></script> <script src="http://localhost:4000/assets/bower_components/imagesloaded/imagesloaded.pkgd.min.js"></script> <script src="http://localhost:4000/assets/bower_components/nanobar/nanobar.min.js"></script> <script src="http://localhost:4000/assets/bower_components/typewrite/dist/typewrite.min.js"></script> <script src="http://localhost:4000/assets/js/search.js"></script> <script src="http://localhost:4000/assets/js/on-scroll-progress.js"></script> <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.20.1/moment.min.js"></script> <script src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script> <!-- for Mathjax support --> <!-- Github Button --> <script async defer src="https://buttons.github.io/buttons.js"></script> <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script> <!-- (you can remove the below scripts but do buy me a coffee to show some support :) --> <!-- Maker widget --> <!-- <script> (function(d, h, m) { var js, fjs = d.getElementsByTagName(h)[0]; if (d.getElementById(m)) { return; } js = d.createElement(h); js.id = m; js.onload = function() { window.makerWidgetComInit({ position: "left", widget: "ofeeof264otl2l5g-zspk40eq2gaomj2n-higi2qphmveubksi" }); }; js.src = "https://makerwidget.com/js/embed.js"; fjs.parentNode.insertBefore(js, fjs); })(document, "script", "dhm"); </script> --> <!-- buy me a coffeee --> <!-- <script data-name="BMC-Widget" src="https://cdnjs.buymeacoffee.com/1.0.0/widget.prod.min.js" data-id="sujaykundu" data-description="Support me on Buy me a coffee!" data-message="" data-color="#FF813F" data-position="right" data-x_margin="10" data-y_margin="10" ></script> --> <!--[if lt IE 7]> <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]--> <!--[if IE 7]> <html class="no-js lt-ie9 lt-ie8"> <![endif]--> <!--[if IE 8]> <html class="no-js lt-ie9"> <![endif]--> <!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]--> </head><body><nav class="navbar navbar-expand-lg fixed-top navbar-dark" id="topNav"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="icono-hamburger" id="navbar-hamburger"> </span> </button> <a class="navbar-brand" href="/">woody's blog</a> <div class="collapse navbar-collapse" id="navbarNav"> <ul class="navbar-nav"> <li class="nav-item"> <a class="nav-link" href="http://localhost:4000/">Home</a> </li> <li class="nav-item"> <a class="nav-link" href="http://localhost:4000/about">About</a> </li> <li class="nav-item"> <a class="nav-link" href="http://localhost:4000/blog">Blog</a> </li> </ul> </div> <ul class="nav justify-content-end"> <li class="nav-item"> <a class="nav-link toggle-search-button" href="#search"> <i class="fa fa-search search-icon" aria-hidden="true"></i> </a> </li> <li class="nav-item"> <input class="nav-link switch theme-toggle" type="checkbox" name="checkbox" /> </li> </ul> </nav> <div id="progress-bar"></div> <!-- Search Form --> <div class="search-form-container"> <form class="search-form"> <fieldset class="search-form__fieldset"> <div class="row"> <div class="col-lg-8 offset-md-2"> <input class="search-form__field" placeholder="Type to Search..." autofocus> <input class="search-form__submit" type="submit" value="search"> </div> </div> </fieldset> </form> <div class="row"> <div class="col-lg-8 offset-md-2 search-results"> <div class="card search-results"></div> </div> </div> <div class="close-search-button search-form-container__close"> <i class="fa fa-times icon"></i> </div> </div><div class="main-container"> <div class="row justify-content-center" id="blog-post-container"> <div class="col-lg-10"><article class="card" itemscope itemtype="http://schema.org/BlogPosting"> <div class="card-header"> <h1 class="post-title" itemprop="name headline">SQL 쿼리 튜닝: 인덱스가 있어도 느린 쿼리</h1> <h4 class="post-meta">인덱스를 추가했는데도 쿼리가 느린 이유를 찾아보고 실행계획 분석의 중요성에 대해 알아봅시다. (feat.자동 형변환)</h4> <p class="post-summary"> Posted by : <span itemprop="author" itemscope itemtype="http://schema.org/Person"> <span itemprop="name"><a href="http://localhost:4000/blog/authors/woodypark">woodypark</a></span> </span> on <time datetime="2025-11-15 20:45:31 +0900" itemprop="datePublished">Nov 15, 2025</time> </p> <span class="disqus-comment-count" data-disqus-identifier="/blog/sql-query-tuning-index-type-conversion/"></span> <div class="post-categories"> Category : <a href="/blog/categories/sql">sql</a> </div> </div> <div class="card-body" itemprop="articleBody"> <img class="card-img-top" src="http://localhost:4000/assets/img/posts/sql1.jpg" alt="" /> <br /> <br /> <h2 id="문제-상황">문제 상황</h2> <p>최근 작업을 하다가 공간 데이터를 다루는 쿼리를 작성했는데, 인덱스를 추가했음에도 불구하고 쿼리 실행 시간이 예상보다 훨씬 오래 걸리는 문제가 발생했습니다.</p> <p>인덱스를 추가했는데도 느리다면, <strong>실제로 인덱스를 타고 있는지 확인</strong>해야 합니다.</p> <h2 id="실행계획-확인-explain의-중요성">실행계획 확인: EXPLAIN의 중요성</h2> <p>쿼리가 느리다고 느껴질 때는 무작정 인덱스를 추가하기보다, 먼저 <strong>실행계획(Execution Plan)을 확인</strong>해야 합니다. PostgreSQL에서는 <code class="language-plaintext highlighter-rouge">EXPLAIN</code> 또는 <code class="language-plaintext highlighter-rouge">EXPLAIN ANALYZE</code>를 사용하여 쿼리의 실행 계획을 확인할 수 있습니다.</p> <blockquote> <p><strong>참고</strong>: 아래 쿼리는 실제 사용 쿼리가 아니라 설명을 위해 수정한 예시입니다.</p> </blockquote> <div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">EXPLAIN</span> <span class="k">ANALYZE</span>
<span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">locations</span> <span class="k">AS</span> <span class="n">lo</span>
<span class="k">WHERE</span> <span class="n">ST_DWithin</span><span class="p">(</span>
    <span class="n">lo</span><span class="p">.</span><span class="n">geom</span><span class="p">::</span><span class="n">geography</span><span class="p">,</span>
    <span class="n">ST_GeomFromText</span><span class="p">(</span><span class="s1">'POINT(127.0 37.5)'</span><span class="p">,</span> <span class="mi">4326</span><span class="p">)::</span><span class="n">geography</span><span class="p">,</span>
    <span class="mi">100</span>
<span class="p">);</span>
</code></pre></div></div> <p>위의 쿼리를 아주 간단히 설명하면 특정 좌표(경도 127.0, 위도 37.5)로부터 100m 거리 안에 있는 모든 locations 값들을 조회하는 쿼리입니다.</p> <p>실행계획을 확인해보니 다음과 같은 결과가 나왔습니다:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Gather  (cost=1000.00..864201.10 rows=16 width=304) (actual time=248.512..3684.564 rows=4 loops=1)
  Workers Planned: 2
  Workers Launched: 2
  -&gt;  Parallel Seq Scan on locations lo  (cost=0.00..863199.50 rows=7 width=304) (actual time=1454.043..3521.002 rows=1 loops=3)
        Filter: st_dwithin((geom)::geography, '...'::geography, '100'::double precision, true)
        Rows Removed by Filter: 9567
Planning Time: 0.111 ms
Execution Time: 3684.599 ms
</code></pre></div></div> <p>실행계획을 보면 <strong>Parallel Seq Scan</strong> (병렬 순차 스캔)이 발생하고 있습니다. 즉, 인덱스를 전혀 사용하지 않고 <strong>테이블 풀스캔(Full Table Scan)</strong>을 하고 있었습니다. 인덱스를 추가했는데도 왜 인덱스를 타지 않을까요?</p> <h2 id="원인-분석-형변환으로-인한-인덱스-미사용">원인 분석: 형변환으로 인한 인덱스 미사용</h2> <p>우선 인덱스가 잘 사용이 되고 있지 않으니 인덱스가 잘 추가되어 있는지부터 확인해야 합니다.</p> <div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">CREATE</span> <span class="k">INDEX</span> <span class="n">idx_location_geometry</span> <span class="k">ON</span> <span class="n">locations</span> <span class="k">USING</span> <span class="n">GIST</span> <span class="p">(</span><span class="n">geom</span><span class="p">);</span>
</code></pre></div></div> <p>문제의 원인을 찾았습니다.</p> <p><strong>GIST 인덱스가 <code class="language-plaintext highlighter-rouge">geometry</code> 타입으로 생성되어 있었는데</strong>, 공간 쿼리를 위해 <code class="language-plaintext highlighter-rouge">geography</code> 타입으로 변환한 후 쿼리를 실행하고 있었습니다.</p> <div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">-- 인덱스는 geometry 타입으로 생성됨</span>
<span class="k">CREATE</span> <span class="k">INDEX</span> <span class="n">idx_location_geometry</span> <span class="k">ON</span> <span class="n">locations</span> <span class="k">USING</span> <span class="n">GIST</span> <span class="p">(</span><span class="n">geom</span><span class="p">);</span>

<span class="c1">-- 하지만 쿼리에서는 geography로 변환</span>
<span class="k">WHERE</span> <span class="n">ST_DWithin</span><span class="p">(</span>
    <span class="n">lo</span><span class="p">.</span><span class="n">geom</span><span class="p">::</span><span class="n">geography</span><span class="p">,</span>  <span class="c1">-- 형변환 발생!</span>
    <span class="n">ST_GeomFromText</span><span class="p">(</span><span class="s1">'POINT(127.0 37.5)'</span><span class="p">,</span> <span class="mi">4326</span><span class="p">)::</span><span class="n">geography</span><span class="p">,</span>
    <span class="mi">100</span>
<span class="p">)</span>
</code></pre></div></div> <blockquote> <p>‼️ <strong>형변환이 발생하면 인덱스를 사용할 수 없습니다.</strong> 데이터베이스는 칼럼의 원본 타입에 맞춰 인덱스를 생성하기 때문에, 쿼리에서 타입을 변환하면 인덱스와 매칭되지 않아 인덱스를 사용하지 못하게 됩니다.</p> </blockquote> <h2 id="이해하기-쉬운-예시">이해하기 쉬운 예시</h2> <p>이를 더 쉽게 이해하기 위해 간단한 예시를 들어보겠습니다.</p> <h3 id="예시-문자열-칼럼에-정수로-검색하기">예시: 문자열 칼럼에 정수로 검색하기</h3> <div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">-- users 테이블의 id 칼럼이 VARCHAR(문자열) 타입으로 저장되어 있다고 가정</span>
<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">users</span> <span class="p">(</span>
    <span class="n">id</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span> <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">,</span>
    <span class="n">name</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
<span class="p">);</span>

<span class="c1">-- id 칼럼에 인덱스가 자동으로 생성됨 (PRIMARY KEY)</span>
<span class="k">CREATE</span> <span class="k">INDEX</span> <span class="n">idx_users_id</span> <span class="k">ON</span> <span class="n">users</span><span class="p">(</span><span class="n">id</span><span class="p">);</span>

<span class="c1">-- 문제가 되는 쿼리: 정수값으로 검색</span>
<span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">users</span> <span class="k">WHERE</span> <span class="n">id</span> <span class="o">=</span> <span class="mi">12345</span><span class="p">;</span>  <span class="c1">-- ❌ 인덱스 미사용</span>
</code></pre></div></div> <p>위 쿼리에서 <code class="language-plaintext highlighter-rouge">id</code>는 문자열 타입인데, 정수값 <code class="language-plaintext highlighter-rouge">12345</code>로 검색하고 있습니다. 이 경우 데이터베이스는 <strong>자동 형변환</strong>을 수행합니다.</p> <p>실제로 데이터베이스 내부에서는 다음과 같이 변환됩니다:</p> <div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">-- 우리가 작성한 쿼리</span>
<span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">users</span> <span class="k">WHERE</span> <span class="n">id</span> <span class="o">=</span> <span class="mi">12345</span><span class="p">;</span>

<span class="c1">-- 데이터베이스가 내부적으로 변환하는 쿼리 (의사 코드)</span>
<span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">users</span> <span class="k">WHERE</span> <span class="n">TO_NUMBER</span><span class="p">(</span><span class="n">id</span><span class="p">)</span> <span class="o">=</span> <span class="mi">12345</span><span class="p">;</span>
<span class="c1">-- 또는</span>
<span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">users</span> <span class="k">WHERE</span> <span class="k">CAST</span><span class="p">(</span><span class="n">id</span> <span class="k">AS</span> <span class="nb">INTEGER</span><span class="p">)</span> <span class="o">=</span> <span class="mi">12345</span><span class="p">;</span>
</code></pre></div></div> <p>즉, <strong>칼럼 자체에 형변환이 발생</strong>하게 됩니다:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>VARCHAR 칼럼(id) = INTEGER 값(12345)
→ TO_NUMBER(id) = 12345  (칼럼에 함수 적용)
→ 칼럼에 함수가 적용되면 인덱스 사용 불가
→ 테이블 풀스캔 발생
</code></pre></div></div> <p><strong>핵심은 칼럼에 함수나 형변환이 적용되면 인덱스를 사용할 수 없다는 점</strong>입니다. 인덱스는 원본 칼럼 값에 대해 생성되기 때문에, 칼럼을 변환한 값으로는 인덱스를 찾을 수 없습니다.</p> <h3 id="해결-방법">해결 방법</h3> <p>간단합니다! <strong>입력값을 칼럼의 타입에 맞게 변환</strong>하면 됩니다.</p> <div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">-- 올바른 쿼리: 문자열로 검색</span>
<span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">users</span> <span class="k">WHERE</span> <span class="n">id</span> <span class="o">=</span> <span class="s1">'12345'</span><span class="p">;</span>  <span class="c1">-- ✅ 인덱스 사용</span>
</code></pre></div></div> <p>입력값을 문자열로 바꿔주면, 데이터베이스는 형변환 없이 인덱스를 사용할 수 있어 쿼리 성능이 크게 향상됩니다.</p> <h2 id="실제-해결-과정">실제 해결 과정</h2> <p>제가 겪었던 공간 쿼리 문제도 동일한 원리였습니다.</p> <h3 id="문제가-된-쿼리">문제가 된 쿼리</h3> <div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">-- geometry 인덱스가 있는데 geography로 변환하여 쿼리</span>
<span class="k">WHERE</span> <span class="n">ST_DWithin</span><span class="p">(</span>
    <span class="n">lo</span><span class="p">.</span><span class="n">geom</span><span class="p">::</span><span class="n">geography</span><span class="p">,</span>  <span class="c1">-- 형변환 발생</span>
    <span class="n">ST_MakePoint</span><span class="p">(</span><span class="mi">127</span><span class="p">.</span><span class="mi">0</span><span class="p">,</span> <span class="mi">37</span><span class="p">.</span><span class="mi">5</span><span class="p">)::</span><span class="n">geography</span><span class="p">,</span>
    <span class="mi">100</span>
<span class="p">);</span>
</code></pre></div></div> <h3 id="해결-방법-1">해결 방법</h3> <div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">-- 방법 1: geometry 타입으로 쿼리 수정 (권장)</span>
<span class="k">SELECT</span> <span class="o">*</span>
<span class="k">FROM</span> <span class="n">locations</span> <span class="k">AS</span> <span class="n">lo</span>
<span class="k">WHERE</span> <span class="n">ST_DWithin</span><span class="p">(</span>
    <span class="n">lo</span><span class="p">.</span><span class="n">geom</span><span class="p">,</span>  <span class="c1">-- 형변환 제거, geometry 타입 그대로 사용</span>
    <span class="n">ST_GeomFromText</span><span class="p">(</span><span class="s1">'POINT(127.0 37.5)'</span><span class="p">,</span> <span class="mi">4326</span><span class="p">),</span>  <span class="c1">-- geometry 타입 그대로 사용</span>
    <span class="mi">0</span><span class="p">.</span><span class="mi">0009</span>  <span class="c1">-- 단위: 도(degree), 약 100m에 해당</span>
<span class="p">);</span>

<span class="c1">-- 방법 2: geography 타입으로 인덱스 재생성</span>
<span class="k">CREATE</span> <span class="k">INDEX</span> <span class="n">idx_locations_geography</span> <span class="k">ON</span> <span class="n">locations</span> <span class="k">USING</span> <span class="n">GIST</span> <span class="p">(</span><span class="n">geom</span><span class="p">::</span><span class="n">geography</span><span class="p">);</span>
</code></pre></div></div> <p>내용이 너무 길어지므로 권장 방법인 1만 검증을 해보겠습니다.</p> <p>geometry 타입으로 쿼리를 수정한 후 실행계획을 다시 확인해보니 다음과 같은 결과가 나왔습니다:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Index Scan using index_locations_on_geom on locations lo  (cost=0.41..268.69 rows=16 width=304) (actual time=0.042..0.138 rows=4 loops=1)
  Index Cond: (geom &amp;&amp; st_expand('...'::geometry, '0.0009'::double precision))
  Filter: st_dwithin(geom, '...'::geometry, '0.0009'::double precision)
  Rows Removed by Filter: 2
Planning Time: 0.098 ms
Execution Time: 0.161 ms
</code></pre></div></div> <h3 id="성능-비교">성능 비교</h3> <p>수정 전후의 실행계획을 비교해보면:</p> <table style="width: 100%; border-collapse: collapse; margin: 20px 0;"> <thead> <tr style="background-color: #2d2d2d; color: #fff;"> <th style="padding: 12px; border: 1px solid #444; text-align: left;">항목</th> <th style="padding: 12px; border: 1px solid #444; text-align: left;">수정 전 (geography 형변환)</th> <th style="padding: 12px; border: 1px solid #444; text-align: left;">수정 후 (geometry)</th> <th style="padding: 12px; border: 1px solid #444; text-align: left;">개선율</th> </tr> </thead> <tbody> <tr style="background-color: #1e1e1e;"> <td style="padding: 12px; border: 1px solid #444;"><strong>스캔 방식</strong></td> <td style="padding: 12px; border: 1px solid #444;">Parallel Seq Scan<br />(병렬 순차 스캔)</td> <td style="padding: 12px; border: 1px solid #444;">Index Scan<br />(인덱스 스캔)</td> <td style="padding: 12px; border: 1px solid #444;">✅ 인덱스 사용</td> </tr> <tr style="background-color: #252525;"> <td style="padding: 12px; border: 1px solid #444;"><strong>실행 시간</strong></td> <td style="padding: 12px; border: 1px solid #444;"><strong>3,684.599 ms</strong></td> <td style="padding: 12px; border: 1px solid #444;"><strong>0.161 ms</strong></td> <td style="padding: 12px; border: 1px solid #444;"><strong>약 22,900배 빠름</strong><br /><strong>99.996% 감소</strong></td> </tr> </tbody> </table> <p>수정 전에는 <strong>3.68초</strong>가 걸렸던 쿼리가, 수정 후에는 <strong>0.16ms</strong>로 단축되었습니다. 이는 <strong>약 22,900배 빠른 성능</strong>이며, 실행 시간이 <strong>99.996% 감소</strong>한 것입니다.</p> <p>실행계획을 보면 이제 <strong>Index Scan</strong>을 사용하고 있어, 인덱스를 통해 효율적으로 데이터를 조회하고 있음을 확인할 수 있습니다.</p> <h2 id="정리-실행계획-확인의-중요성">정리: 실행계획 확인의 중요성</h2> <p>이 경험을 통해 배운 점은 다음과 같습니다:</p> <ol> <li><strong>인덱스를 추가했다고 해서 항상 인덱스를 사용하는 것은 아니다</strong></li> <li><strong>쿼리가 느리다면 반드시 실행계획을 확인해야 한다</strong></li> <li><strong>형변환이 발생하면 인덱스를 사용할 수 없다</strong></li> <li><strong>칼럼의 타입과 쿼리의 타입이 일치해야 인덱스가 제대로 작동한다</strong></li> </ol> <p>쿼리 성능 문제가 발생했을 때, 실행계획을 확인하고 왜 느린지 정확히 판단할 수 있는 능력이 중요합니다. 단순히 인덱스를 추가하는 것만으로는 해결되지 않는 경우가 많기 때문입니다.</p> <h2 id="마무리">마무리</h2> <p>데이터베이스 쿼리 튜닝은 단순히 인덱스를 추가하는 것이 전부가 아닙니다. 실행계획을 분석하고, 왜 인덱스를 사용하지 못하는지 원인을 파악하는 것이 더 중요합니다.</p> <p>특히 <strong>형변환으로 인한 인덱스 미사용</strong>은 흔히 발생하는 문제이지만, 해결 방법은 간단합니다. 칼럼의 타입에 맞게 쿼리를 작성하면 됩니다.</p> <p>다음번에 쿼리가 느리다고 느껴질 때는, 먼저 <code class="language-plaintext highlighter-rouge">EXPLAIN</code>으로 실행계획을 확인해봅시다!</p> <blockquote> <p><strong>⚠️ 주의사항</strong></p> <p>이 글에서는 인덱스를 사용하지 못해 발생한 성능 문제를 다뤘지만, <strong>인덱스만 사용한다고 해서 항상 성능이 좋아지는 것은 아닙니다.</strong> 테이블의 대부분의 데이터를 조회해야 하는 경우나, 데이터가 매우 적은 경우에는 오히려 <strong>풀스캔(Full Table Scan)이 더 효율적</strong>일 수 있습니다.</p> <p>다만, <strong>OLTP(Online Transaction Processing) 환경</strong>에서는 대부분의 쿼리가 소량의 데이터를 조회하는 경우가 많기 때문에, 인덱스를 통한 성능 향상이 주로 발생합니다. 따라서 이 글에서는 인덱스 활용에 초점을 맞춰 작성했습니다.</p> <p>추후에는 <strong>풀스캔이 인덱싱보다 더 효율적인 경우</strong>에 대해서도 다뤄보겠습니다.</p> </blockquote> <br /> <!-- Author box --> <div class="card"> <div class="card-header"> About Woody Park </div> <div class="card-body"> <div class="row"> <div class="col-md-4"> <img class="author-profile-img" src="http://localhost:4000/assets/img/authors/woodypark.png" alt="Woody Park" /> </div> <div class="col-md-6"> <p class="author_bio">Hi, my name is Woody Park. I'm a backend developer.</p> <p>Email : harry122226@gmail.com</p> <p>Website : https://github.com/wooodypark</p> <p class="profile-links"> <a class="social-link" href="https://github.com/wooodypark" target="_blank"><i class="fab fa-github fa-fw"></i></a> <a class="social-link" href="https://www.linkedin.com/in/seonghyun-park-2aa461387" target="_blank"><i class="fab fa-linkedin fa-fw"></i></a> </p> </div> </div> </div> </div> </div> <div class="comments"> <script src="https://giscus.app/client.js" data-repo="sujaykundu777/devlopr-jekyll" data-repo-id="MDEwOlJlcG9zaXRvcnkxMzk1NzQ1NTY=" data-category="General" data-category-id="MDE4OkRpc2N1c3Npb25DYXRlZ29yeTMyODk4MTky" data-mapping="pathname" data-strict="0" data-reactions-enabled="1" data-emit-metadata="0" data-input-position="bottom" data-theme="preferred_color_scheme" data-lang="en" crossorigin="anonymous" async> </script> </div><!-- Incomment incase you want to use Disqus <div id="disqus_thread"></div> --> </article><script> var disqus_config = function () { this.page.url = "http://localhost:4000/blog/sql-query-tuning-index-type-conversion/"; /* Replace PAGE_URL with your page's canonical URL variable */ this.page.identifier = "/blog/sql-query-tuning-index-type-conversion"; /* Replace PAGE_IDENTIFIER with your page's unique identifier variable */ }; (function () { /* DON'T EDIT BELOW THIS LINE */ var d = document, s = d.createElement('script'); s.src = 'https://.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); </script> <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a> </noscript></div> </div> <div class="row"> <div class="col-md-4"> <div class="card"> <div class="card-header">About Woody Park</div> <div class="card-body"> <p class="author_bio">Hi, my name is Woody Park. I'm a backend developer.</p> <!-- Place this tag where you want the button to render. --> <a class="github-button" href="https://github.com/wooodypark" data-size="large" data-color-scheme="no-preference: dark; light: dark; dark: dark;" data-show-count="true" aria-label="Follow @wooodypark on GitHub">Follow @wooodypark</a> </div> </div> </div> <div class="col-md-4"> <div class="card"> <div class="card-header">Categories</div> <div class="card-body text-dark"><ul> <div id="#sql"></div> <li class="tag-head"> <a href="/blog/categories/sql">sql</a> </li> <a name="sql"></a> </ul></div> </div> </div> <div class="col-md-4"> <div class="card"> <div class="card-header">Useful Links</div> <div class="card-body text-dark"> <li> <a href="http://localhost:4000/">Home</a> </li> <li> <a href="http://localhost:4000/about">About</a> </li> <li> <a href="http://localhost:4000/blog">Blog</a> </li> </div> </div> </div> </div> </div><footer> <p> <strong>Woody Park</strong> - Hi, my name is Woody Park. I'm a backend developer. <br> <a href="https://github.com/wooodypark" target="_blank">GitHub</a> | <a href="https://www.linkedin.com/in/seonghyun-park-2aa461387" target="_blank">LinkedIn</a> | <a href="mailto:harry122226@gmail.com">Email</a> <br> <small style="color: #999;">Theme by <a href="https://github.com/sujaykundu777/devlopr-jekyll" target="_blank" style="color: #999;">devlopr-jekyll</a></small> </p> </footer><script> var options = { classname: 'progressline', id: 'my-id' }; var nanobar = new Nanobar(options); nanobar.go(30); nanobar.go(76); nanobar.go(100); </script> <div hidden id="snipcart" data-api-key="Y2I1NTAyNWYtMTNkMy00ODg0LWE4NDItNTZhYzUxNzJkZTI5NjM3MDI4NTUzNzYyMjQ4NzU0"> </div> <script src="https://cdn.snipcart.com/themes/v3.0.0-beta.3/default/snipcart.js" defer></script> <script> if (window.netlifyIdentity) { window.netlifyIdentity.on("init", user => { if (!user) { window.netlifyIdentity.on("login", () => { document.location.href = "/admin/"; }); } }); } </script> </body> </html>
